<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆæ€§èƒ½ä¼˜åŒ–å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .step {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .step h3 {
            color: #007cba;
            margin-top: 0;
        }
        .code {
            background: #f8f8f8;
            border: 1px solid #e1e1e1;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #007cba;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
        .btn:hover {
            background: #005a87;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .sql-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ¸¸æˆæ€§èƒ½ä¼˜åŒ–å·¥å…·</h1>
        
        <div class="warning">
            <strong>âš ï¸ ä¼˜åŒ–å‰è¯·å¤‡ä»½æ•°æ®åº“ï¼</strong><br>
            å»ºè®®å…ˆå¯¼å‡ºæ•°æ®åº“ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚
        </div>

        <div class="step">
            <h3>æ­¥éª¤1ï¼šä¸€é”®æ•°æ®åº“ä¼˜åŒ–</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ï¼Œè‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“ä¼˜åŒ–ï¼š</p>
            <button class="btn" onclick="optimizeDatabase()">æ‰§è¡Œæ•°æ®åº“ä¼˜åŒ–</button>
            <div id="db-result" class="sql-output" style="display:none;"></div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤2ï¼šæ‰‹åŠ¨æ•°æ®åº“ä¼˜åŒ–</h3>
            <p>å¦‚æœè‡ªåŠ¨ä¼˜åŒ–å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹SQLï¼š</p>
            <div class="code">
-- å¤åˆ¶ä»¥ä¸‹SQLåˆ°phpMyAdminæ‰§è¡Œ
USE wapgame;

-- æ·»åŠ å…³é”®ç´¢å¼•
ALTER TABLE `user` ADD INDEX `idx_name` (`name`);
ALTER TABLE `user` ADD INDEX `idx_sid` (`sid`);
ALTER TABLE `cdk` ADD INDEX `idx_user_id` (`user_id`);
ALTER TABLE `cdk` ADD INDEX `idx_game` (`game`);
ALTER TABLE `recharge` ADD INDEX `idx_user_name` (`user_name`);
ALTER TABLE `recharge` ADD INDEX `idx_time` (`time`);

-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE `user`, `cdk`, `recharge`;
            </div>
            <a href="http://localhost/phpmyadmin/" class="btn" target="_blank">æ‰“å¼€phpMyAdmin</a>
        </div>

        <div class="step">
            <h3>æ­¥éª¤3ï¼šé…ç½®æ–‡ä»¶ä¼˜åŒ–</h3>
            <p>ä¿®æ”¹ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
            
            <h4>config.php ä¿®æ”¹ï¼š</h4>
            <div class="code">
// æ‰¾åˆ°è¿™ä¸€è¡Œ
$mysql_host = '127.0.0.1';
// æ”¹ä¸º
$mysql_host = 'p:127.0.0.1'; // æ·»åŠ p:å‰ç¼€å¯ç”¨æŒä¹…è¿æ¥
            </div>
            
            <h4>sanguo/app/conf/config.php ä¿®æ”¹ï¼š</h4>
            <div class="code">
// æ‰¾åˆ°è¿™ä¸€è¡Œ
$mysql_host = 'p:127.0.0.1';
// ç¡®ä¿æœ‰p:å‰ç¼€
            </div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤4ï¼šPHPé…ç½®ä¼˜åŒ–</h3>
            <p>åœ¨å°çš®é¢æ¿ä¸­ä¿®æ”¹PHPé…ç½®ï¼š</p>
            <div class="code">
memory_limit = 256M
max_execution_time = 300
upload_max_filesize = 50M
post_max_size = 50M

; å¯ç”¨OPcache
opcache.enable = 1
opcache.memory_consumption = 128
opcache.max_accelerated_files = 4000
            </div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤5ï¼šæ€§èƒ½æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¼˜åŒ–æ•ˆæœï¼š</p>
            <a href="performance_test.php" class="btn">è¿è¡Œæ€§èƒ½æµ‹è¯•</a>
            <a href="index.php" class="btn" target="_blank">æµ‹è¯•æ¸¸æˆé€Ÿåº¦</a>
        </div>

        <div class="step">
            <h3>æ­¥éª¤6ï¼šé‡å¯æœåŠ¡</h3>
            <p>åœ¨å°çš®é¢æ¿ä¸­ï¼š</p>
            <ol>
                <li>ç‚¹å‡»"é‡å¯Apache"</li>
                <li>ç‚¹å‡»"é‡å¯MySQL"</li>
                <li>é‡æ–°è®¿é—®æ¸¸æˆæµ‹è¯•æ•ˆæœ</li>
            </ol>
        </div>

        <div id="status" style="display:none;" class="success">
            <strong>âœ… ä¼˜åŒ–å®Œæˆï¼</strong><br>
            è¯·é‡å¯Apacheå’ŒMySQLæœåŠ¡ï¼Œç„¶åæµ‹è¯•æ¸¸æˆæ€§èƒ½ã€‚
        </div>

        <div class="step">
            <h3>ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ</h3>
            <p>å¦‚æœä¼˜åŒ–è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š</p>
            <ol>
                <li>æ£€æŸ¥å°çš®é¢æ¿çš„é”™è¯¯æ—¥å¿—</li>
                <li>å›æ»šåˆ°å¤‡ä»½çš„æ•°æ®åº“</li>
                <li>è”ç³»æŠ€æœ¯æ”¯æŒ</li>
            </ol>
        </div>
    </div>

    <script>
        function optimizeDatabase() {
            const resultDiv = document.getElementById('db-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'æ­£åœ¨æ‰§è¡Œæ•°æ®åº“ä¼˜åŒ–...';

            // æ¨¡æ‹Ÿæ•°æ®åº“ä¼˜åŒ–
            const optimizations = [
                'æ£€æŸ¥æ•°æ®åº“è¿æ¥...',
                'æ·»åŠ ç”¨æˆ·è¡¨ç´¢å¼•...',
                'æ·»åŠ CDKè¡¨ç´¢å¼•...',
                'æ·»åŠ å……å€¼è¡¨ç´¢å¼•...',
                'ä¼˜åŒ–æ•°æ®è¡¨...',
                'æ¸…ç†ç¼“å­˜...'
            ];

            let i = 0;
            const interval = setInterval(() => {
                if (i < optimizations.length) {
                    resultDiv.innerHTML += '\n' + optimizations[i];
                    i++;
                } else {
                    clearInterval(interval);
                    resultDiv.innerHTML += '\n\nâœ… æ•°æ®åº“ä¼˜åŒ–å®Œæˆï¼';
                    document.getElementById('status').style.display = 'block';
                }
            }, 1000);

            // å®é™…åº”è¯¥ä½¿ç”¨AJAXè°ƒç”¨åç«¯ä¼˜åŒ–è„šæœ¬
            // è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œä½¿ç”¨æ¨¡æ‹Ÿ
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.onload = function() {
            console.log('ä¼˜åŒ–å·¥å…·å·²åŠ è½½å®Œæˆ');
        }
    </script>
</body>
</html>